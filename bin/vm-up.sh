#!/bin/bash

set -e

source $UTILS_DC

function create_resolver_file {
  echo "*** Checking resolver file..."
  echo ""

  # Make the directory
  if [ ! -e $RESOLVER_DIR ]; then 
    sudo mkdir -p $RESOLVER_DIR
    echo "Created new directory $RESOLVER_DIR"
    echo ""
  fi

  if [ -e $RESOLVER_FILE ]; then 
    echo "-> Removing old resolver file $RESOLVER_FILE ..."
    sudo rm $RESOLVER_FILE
    echo ""
  fi
  

  echo "-> Creating new resolver file $RESOLVER_FILE ..."
  sudo sh -c "echo '# This is auto-generated. Do NOT edit this file\nnameserver 127.0.0.1 \nport $DNS_PORT' >> $RESOLVER_FILE"
  echo "Resolver created: $RESOLVER_FILE"
  echo ""
  echo "---"
}

create_resolver_file
