#!/bin/bash

set -e

source $UTILS_DC

function main {
  echo -e "=> Checking resolver file...\n"

  # Make the directory
  if [ ! -e $RESOLVER_DIR ]; then 
    sudo mkdir -p $RESOLVER_DIR
    echo -e "Created new directory: $RESOLVER_DIR\n"
  fi

  if [ -e $RESOLVER_FILE ]; then 
    echo "=> Removing old resolver file $RESOLVER_FILE ..."
    sudo rm $RESOLVER_FILE
    echo -e "=> Successfully removed $RESOLVER_FILE\n"
  fi
  

  echo "=> Creating new resolver file $RESOLVER_FILE ..."
  sudo sh -c "echo '# This is auto-generated. Do NOT edit this file\nnameserver 127.0.0.1 \nport $DNS_PORT' >> $RESOLVER_FILE"
  echo -e "=> Successfully created resolver file: $RESOLVER_FILE\n"
}

main
